#!/usr/bin/env bash
set -e

### TODO: THInk about how this is going to be started - the proxy is going
## to need creds added from vault, the OW deploy already does this
## maybe makes more sense to add this to there?
## Either way think a bit more about how this is all fitting together

function start_proxy {
  docker run mrcide/hiv-orderly-proxy:latest
}

function start_ow {
  orderly-web start $1 --pull
}

for var in "$@"; do
  if [ $var == "all" ]; then
    ## List all config directories i.e. all directories except "scripts"
    configs = `find * -type d | egrep -v '^scripts/|/scripts/|scripts'`
    start_proxy
    for conf in $configs; do
      start_ow $conf
    done
  elif [ $var == "proxy" ]; then
    start_proxy
  else
    start_ow $var
  fi
done

